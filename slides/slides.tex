\documentclass[aspectratio=1610]{beamer}

\usepackage{appendixnumberbeamer}
\usepackage[USenglish]{babel}
\usepackage[backend=bibtex,citestyle=authortitle]{biblatex}
\usepackage[scale=2]{ccicons}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{multicol}
\usepackage{tikz}

% this actually isn't totally hideous:
\usetheme[numbering=counter, progressbar=frametitle, sectionpage=none]{metropolis}
\setbeamertemplate{bibliography item}[text]
\setbeamertemplate{frametitle continuation}{}

\title{Composable Concurrency Models}
\date{November 19, 2016}
\author{Dan Stelljes}

\bibliography{references}

\AtEveryBibitem{\clearfield{note}}
\AtEveryBibitem{\clearfield{url}}

\begin{document}
  \maketitle

  \begin{frame}
    \centering
    \resizebox{0.8\linewidth}{!}{\input{../figures/introduction.tikz}}
  \end{frame}

  \begin{frame}
    \begin{multicols}{2}
      \tableofcontents
    \end{multicols}
  \end{frame}

  \section{Background}

  \subsection{Concurrency}

  \begin{frame}
    \frametitle{Concurrency}

    \textbf{The ``happens before'' ($\rightarrow$) relation~\footcite{Lamport1977}}

    $A \rightarrow B$ if one of the following is true:

    \begin{enumerate}
      \item $A$ and $B$ are operations in the same thread and $A$ occurs before $B$.
      \item $A$ is the sending of a message by one thread and $B$ is the receipt of the same message by another thread.
    \end{enumerate}

    If $A \rightarrow B$ and $B \rightarrow C$, then $A \rightarrow C$.

    $A$ and $B$ are said to be concurrent if $A \nrightarrow B$ and $B \nrightarrow A$.
  \end{frame}

  \subsection{Complications}

  \begin{frame}
    \frametitle{Complications}

    \begin{itemize}
      \onslide<1->{
        \item \textbf{Sequential program:} Does the order of operations yield a correct result?
      }

      \vfill

      \onslide<2->{
        \item \textbf{Concurrent program:} Does \emph{every possible} order of operations yield a correct result?
      }
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Complications}
    \centering

    \textbf{Single thread:}
    \vfill
    \resizebox{0.9\linewidth}{!}{\input{../figures/single-thread-read-write.tikz}}
  \end{frame}

  \begin{frame}
    \frametitle{Complications}
    \centering

    \textbf{Multiple threads:}
    \vfill
    \resizebox{0.9\linewidth}{!}{\input{../figures/multiple-threads-read-write.tikz}}
  \end{frame}

  \begin{frame}
    \frametitle{Complications}

    \centering
    \input{../figures/noninstantaneity.tikz}
  \end{frame}

  \subsection{Consistency models}

  \begin{frame}
    \frametitle{Linearizability}

    \begin{figure}
      \centering
      \input{../figures/linearizability.tikz}
    \end{figure}

    \vfill

    \begin{itemize}
      \item Linearizability guarantees that the completion of an operation on a single object will appear to be instantaneous.
      \item The results of a linearizable operation will be visible as soon as the operation is complete.
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Serializability}

    \begin{figure}
      \centering
      \input{../figures/serializability.tikz}
    \end{figure}

    \vfill

    \begin{itemize}
      \item Serializability guarantees that operations can occur in any order as long as an equivalent sequential ordering exists.
      \item While a serializable set of operations is being executed, it appears to be the only set of operations being executed.
    \end{itemize}
  \end{frame}

  \begin{frame}
    \frametitle{Strict serializability}

    \begin{itemize}
      \item Linearizability \emph{and} serializability yield strict serializability, which guarantees both consistency and isolation.
    \end{itemize}

    \vfill

    \textbf{Strict serializability~\footcite{Herlihy1990}}

    An ordering of operations is equivalent to some sequential ordering and that ordering corresponds to the order of execution in real time.
  \end{frame}

  \addtocontents{toc}{\hfill}

  \section{Concurrency models}

  \subsection{Atomic variables}

  \begin{frame}
    \frametitle{Atomic variables}

    \begin{columns}
      \begin{column}{0.5\textwidth}
        \centering
        \input{../figures/nonatomic.tikz}
      \end{column}
      \hfill
      \begin{column}{0.5\textwidth}
        $x = 23$

        \begin{enumerate}
          \item $A$ reads $x$
          \item $B$ reads $x$
          \item $A$ increments value
          \item $A$ writes incremented value to $x$
          \item $B$ increments value
          \item $B$ writes incremented value to $x$
        \end{enumerate}

        $x = 24$
      \end{column}
    \end{columns}
  \end{frame}

  \begin{frame}
    \frametitle{Atomic variables}

    \begin{columns}
      \begin{column}{0.5\textwidth}
        \centering
        \input{../figures/atomic.tikz}
      \end{column}
      \hfill
      \begin{column}{0.5\textwidth}
        $x = 23$

        \begin{enumerate}
          \item $A$ calls \textsc{fetch-and-increment} on $x$
          \item $B$ calls \textsc{fetch-and-increment} on $x$
        \end{enumerate}

        $x = 25$
      \end{column}
    \end{columns}
  \end{frame}

  \begin{frame}
    \frametitle{Atomic variables}
    \centering
    \input{../figures/lock.tikz}
  \end{frame}

  \begin{frame}
    \frametitle{Atomic variables}
    \centering
    \input{../figures/multiple-locks.tikz}
  \end{frame}

  \subsection{Software transactional memory}

  \begin{frame}
    \frametitle{Software transactional memory}
    \centering

    \includegraphics[width=220pt]{../figures/stm}
  \end{frame}

  \begin{frame}
    \frametitle{Software transactional memory}

    Software transactional memory (STM) is an optimistic approach to working with shared memory:~\footcite{Shavit1995}

    \begin{enumerate}
      \item A thread writes to a shared memory location, keeping track of the transaction in a log.
      \item If there are conflicting changes at the end of the transaction, the transaction is aborted and retried.
      \item If there are no conflicts, the changes are committed and become visible.
    \end{enumerate}
  \end{frame}

  \subsection{Communicating threads}

  \begin{frame}
    \frametitle{Communicating threads}
    \centering

    \includegraphics[width=220pt]{../figures/agent}
    \vfill
    \textbf{Agents:} An isolated thread handles all operations on an object.~\footcite{Swalens2014}
  \end{frame}

  \begin{frame}
    \frametitle{Communicating threads}
    \centering

    \includegraphics[width=220pt]{../figures/csp}
    \vfill
    \textbf{Communicating sequential processes (CSP):} Independent threads communicate synchronously through predefined channels.~\footcite{Hoare1978}
  \end{frame}

  \begin{frame}
    \frametitle{Communicating threads}
    \centering

    \includegraphics[width=220pt]{../figures/actor}
    \vfill
    \textbf{The actor model:} Independent threads send messages to known addresses.~\footcite{Agha1986}
  \end{frame}

  % never change, LaTeX
  \addtocontents{toc}{\newpage}

  \section{Composability}

  \subsection{Correctness criteria}

  \begin{frame}
    \frametitle{Correctness criteria}

    \textbf{How do we know that models are composable?~\footcite{Swalens2014}}

    \begin{itemize}
      \item Safety: ``Nothing bad will happen!'' (The output of a program or algorithm will not be incorrect.)
      \item Liveness: ``Something will eventually happen!'' (The program or algorithm will terminate.)
    \end{itemize}

    Two models are composable if using them within each other doesn't compromise safety or liveness.
  \end{frame}

  \begin{frame}
    \frametitle{Composability criteria}
    \centering

    \includegraphics[width=360pt]{../figures/clojure-survey}
  \end{frame}

  \subsection{Possible conflicts}

  \begin{frame}
    \frametitle{Possible conflicts}

    \begin{itemize}
      \onslide<1->{
        \item A model reexecutes code containing another model that performs an irrevocable action.
      }
      \vfill
      \onslide<2->{
        \item A model reexecutes code that causes the reexecution to continually happen.
      }
      \vfill
      \onslide<3->{
        \item A model that supports blocking operations is used within a model that does not support blocking operations.
      }
      \vfill
      \onslide<4->{
        \item A model does not guarantee safety or liveness by design, making composability impossible.
      }
    \end{itemize}
  \end{frame}

  \subsection{Conclusions}

  \begin{frame}
    \frametitle{Conclusions}

    \begin{itemize}
      \onslide<1->{
        \item The language may ensure that some bad interactions don't happen.
      }
      \vfill
      \onslide<2->{
        \item Sometimes, it's best to just use a different concurrency model.
      }
      \vfill
      \onslide<3->{
        \item Future work would identify common ``building blocks'' (thread creation, message passing, etc.) that could be composed to express existing concurrency models and combinations of models.
      }
    \end{itemize}
  \end{frame}

  \begin{frame}[standout]
    \centering
    Thanks to Elena Machkasova, K.K. Lamberty, and Matthew Justin for their guidance and suggestions.
    \vfill
    \href{https://github.com/dstelljes/senior-sem}{github.com/dstelljes/senior-sem}
    \vfill
    \ccbyncsa{}
  \end{frame}

  \appendix{}

  \begin{frame}[allowframebreaks]
    \frametitle{References}

    \printbibliography{}
  \end{frame}

\end{document}
